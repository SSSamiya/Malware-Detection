from USstrings import *
import struct
import sys
import base64
import re

FILE_PATH = sys.argv[1]
config = {}

if __name__ == "__main__":
    try:
        data = []
        data = get_US_strings(FILE_PATH)
        #print(*data, sep="\n")
        cidposition = 0
        for i in range(len(data)):
            if((data[i].decode()).endswith("=")):
                cidposition = i
                break
        try:
            if((data[cidposition + 1].decode()) == 'im523'):
                config["Version"] = data[cidposition + 1].decode()
                compaign = base64.b64decode(data[cidposition])
                config["Compaign ID"] = compaign.decode()
                config["Install Directory"] = data[1].decode()
                config["Install Name"] = data[2].decode()
                config["Host"] = data[3].decode()
                config["Port"] = data[5].decode()
                print(config)

            elif((data[cidposition + 1].decode()) == '0.7d'):
                config["Version"] = data[cidposition + 1].decode()
                compaign = base64.b64decode(data[cidposition])
                config["Compaign ID"] = compaign.decode()

                for i in range(cidposition - 10, cidposition - 1):
                    if(re.match("\d{2,5}.\d{2,5}.\d{1,5}.\d{1,5}", data[i].decode())):
                        config["Host"] = data[i].decode()
                        config["Port"] = data[i + 2].decode()
                        config["Startup"] = data[i + 3].decode()
                        config["Registry"] = data[i + 4].decode()
                        print(config)

        except:
            pass
    except Exception as e:
        print(e)
